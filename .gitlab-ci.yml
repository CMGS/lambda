image: hub.ricebook.net/base/centos:onbuild-eru-core-2017.07.26
stages:
- test
- build
- rpm
test:
  stage: test
  script:
  - cp -r $CI_PROJECT_DIR $GOPATH/src/gitlab.ricebook.net/platform/
  - cd $GOPATH/src/gitlab.ricebook.net/platform/lambda
  - make test
build:
  stage: build
  script:
  - cp -r $CI_PROJECT_DIR $GOPATH/src/gitlab.ricebook.net/platform/
  - cd $GOPATH/src/gitlab.ricebook.net/platform/lambda
  - make build
  - cp -r lambda $CI_PROJECT_DIR
  artifacts:
    expire_in: 1 week
    paths:
    - lambda
rpm:
  stage: rpm
  dependencies:
  - build
  script:
  - ./make-rpm
  artifacts:
    expire_in: 1 week
    paths:
    - eru-lambda*.rpm
